<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Police Platinum ‚Äî –ü–∞–Ω–µ–ª—å –æ—Ñ–∏—Ü–µ—Ä–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #0d1b2a;
      --bg-light: #1b263b;
      --bg-lighter: #415a77;
      --text: #e0e1dd;
      --muted: #9ca3af;
      --border: #27374d;
      --accent: #3a7ca5;
      --accent-hover: #539ecf;
      --danger: #d9534f;
      --success: #22c55e;
      --input-bg: #0f172a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px;
    }

    #app {
      width: 100%;
      max-width: 1300px;
    }

    a {
      color: var(--accent-hover);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* ---------- –ö–ù–û–ü–ö–ò ---------- */

    .btn {
      padding: 8px 14px;
      background: var(--accent);
      color: var(--text);
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 14px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .btn:hover {
      background: var(--accent-hover);
    }

    .btn-outline {
      background: transparent;
      border-color: var(--border);
    }
    .btn-outline:hover {
      background: var(--bg-lighter);
    }

    .btn-danger {
      background: var(--danger);
      border-color: #a2302d;
    }
    .btn-danger:hover {
      background: #b53632;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    /* ---------- –ò–ù–ü–£–¢–´ ---------- */

    .field {
      margin-bottom: 10px;
    }
    .field label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
    }
    .field input,
    .field select,
    .field textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 14px;
    }
    .field textarea {
      resize: vertical;
      min-height: 70px;
    }
    .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 3px;
    }
    .error {
      font-size: 11px;
      color: #f97373;
      margin-top: 3px;
    }

    /* ---------- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---------- */

    #auth-root {
      max-width: 480px;
      margin: 0 auto;
    }

    .card {
      background: var(--bg-light);
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 18px 18px 20px;
      margin-bottom: 16px;
    }

    .card h1 {
      font-size: 22px;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .card .subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 16px;
    }

    .auth-switch {
      margin-top: 10px;
      font-size: 13px;
      text-align: right;
      color: var(--muted);
      cursor: pointer;
    }
    .auth-switch span {
      color: var(--accent-hover);
    }

    .auth-screen {
      display: none;
    }
    .auth-screen.active {
      display: block;
    }

    .row-inline {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    /* ---------- –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–ê–ù–ï–õ–ò ---------- */

    #panel-root {
      display: none;
    }

    .navbar {
      background: var(--bg-light);
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .nav-btn {
      padding: 7px 12px;
      background: var(--bg-lighter);
      border-radius: 6px;
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .nav-btn:hover {
      background: var(--accent-hover);
    }
    .nav-btn.active {
      background: var(--accent);
    }

    .nav-right {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .top-user {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--muted);
    }

    .top-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: var(--input-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      overflow: hidden;
      flex-shrink: 0;
    }
    .top-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .top-name {
      font-size: 13px;
      color: var(--text);
    }

    .top-role {
      font-size: 11px;
      color: var(--muted);
    }

    .back-home-btn {
      padding: 5px 10px;
      font-size: 12px;
      background: var(--bg-lighter);
      border-radius: 6px;
      border: 1px solid var(--border);
      cursor: pointer;
    }
    .back-home-btn:hover {
      background: var(--accent-hover);
    }

    /* ---------- –°–ï–ö–¶–ò–ò –ü–ê–ù–ï–õ–ò ---------- */

    .section {
      display: none;
      background: var(--bg-light);
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 16px;
      min-height: 420px;
    }
    .section.active {
      display: block;
    }

    .section h2 {
      font-size: 18px;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .section p {
      font-size: 14px;
      color: var(--text);
      margin-bottom: 6px;
    }

    .section small {
      font-size: 12px;
      color: var(--muted);
    }

    /* ---------- –ì–õ–ê–í–ù–ê–Ø ---------- */

    .home-actions {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    /* ---------- –õ–ò–ß–ù–´–ï –î–ï–õ–ê ---------- */

    .files-layout {
      display: grid;
      grid-template-columns: 320px minmax(0, 1fr);
      gap: 16px;
      margin-top: 10px;
    }

    .files-list {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      max-height: 430px;
      overflow-y: auto;
      background: var(--bg);
    }

    .file-item {
      padding: 7px 8px;
      border-radius: 6px;
      border: 1px solid transparent;
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 6px;
    }
    .file-item:hover {
      background: var(--bg-lighter);
    }
    .file-item.me {
      border-color: var(--accent);
      background: rgba(58,124,165,0.2);
    }
    .file-item.active {
      background: var(--accent);
      border-color: var(--accent-hover);
    }
    .file-title {
      font-weight: 500;
    }
    .file-meta {
      font-size: 12px;
      color: var(--muted);
    }

    .files-detail {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      background: var(--bg);
    }

    .files-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .badge-readonly {
      font-size: 11px;
      color: var(--muted);
    }

    .badge-editable {
      font-size: 11px;
      color: var(--success);
    }

    .personal-note {
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
    }

    /* ---------- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ---------- */

    .admin-users-list {
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 10px;
      max-height: 460px;
      overflow-y: auto;
      background: var(--bg);
    }

    .admin-user-card {
      border-radius: 6px;
      border: 1px solid var(--border);
      padding: 8px;
      margin-bottom: 8px;
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 8px;
      align-items: center;
    }

    .admin-user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: var(--input-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      overflow: hidden;
    }
    .admin-user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .admin-user-main {
      font-size: 13px;
    }

    .admin-user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
      gap: 8px;
    }

    .admin-user-nick {
      font-weight: 500;
    }

    .admin-role-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--border);
    }

    .admin-role-badge.admin {
      border-color: var(--accent);
      color: var(--accent-hover);
    }
    .admin-role-badge.moderator {
      border-color: #4f46e5;
      color: #a5b4fc;
    }

    .admin-user-meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .admin-user-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .admin-select {
      padding: 4px 6px;
      font-size: 12px;
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .admin-color {
      width: 60px;
      height: 26px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      padding: 0;
    }

    .admin-avatar-input {
      font-size: 11px;
      color: var(--muted);
    }

    /* ---------- –ú–û–î–ê–õ–ö–ò ---------- */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      width: 100%;
      max-width: 480px;
      background: var(--bg-light);
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 16px;
    }
    .modal h3 {
      font-size: 18px;
      margin-bottom: 8px;
    }
    .modal p {
      font-size: 13px;
      color: var(--text);
      margin-bottom: 6px;
    }

    .modal-footer {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .search-input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 13px;
      margin-bottom: 8px;
    }

    .search-result-item {
      padding: 5px 6px;
      border-radius: 6px;
      border: 1px solid transparent;
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 4px;
    }
    .search-result-item:hover {
      background: var(--bg-lighter);
    }

    /* ---------- –ê–î–ê–ü–¢–ò–í ---------- */

    @media (max-width: 900px) {
      .files-layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 8px;
      }
      .navbar {
        flex-wrap: wrap;
      }
      .nav-right {
        margin-left: 0;
        margin-top: 6px;
      }
    }
  </style>
</head>
<body>
<div id="app">

  <!-- ===================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ===================== -->
  <div id="auth-root">
    <div class="card">
      <section id="register-screen" class="auth-screen active">
        <h1>Police Platinum</h1>
        <p class="subtitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ñ–∏—Ü–µ—Ä–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏.</p>

        <form id="register-form" novalidate>
          <div class="field">
            <label for="reg-nick">–ù–∏–∫ (–ò–º—è_–§–∞–º–∏–ª–∏—è)</label>
            <input id="reg-nick" type="text" placeholder="Marsello_Nelson" autocomplete="off" />
            <div class="hint">–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã + –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ. –ü—Ä–∏–º–µ—Ä: John_Smith</div>
            <div class="error" id="reg-nick-error"></div>
          </div>

          <div class="field">
            <label for="reg-password">–ü–∞—Ä–æ–ª—å</label>
            <input id="reg-password" type="password" placeholder="–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" />
            <div class="error" id="reg-password-error"></div>
          </div>

          <div class="field">
            <label for="reg-dept">–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç (–∏–≥—Ä–æ–≤–æ–π)</label>
            <select id="reg-dept">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç‚Ä¶</option>
              <option value="LSPD">LSPD ‚Äî Los Santos PD</option>
              <option value="SFPD">SFPD ‚Äî San Fierro PD</option>
              <option value="LVPD">LVPD ‚Äî Las Venturas PD</option>
            </select>
            <div class="error" id="reg-dept-error"></div>
          </div>

          <div class="field">
            <label for="reg-avatar">–ê–≤–∞—Ç–∞—Ä–∫–∞</label>
            <input id="reg-avatar" type="file" accept="image/*" />
            <div class="hint">–ö–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω–∞ –¥–æ 500√ó500 –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Supabase (bucket avatars).</div>
            <div class="error" id="reg-avatar-error"></div>
          </div>

          <button class="btn" type="submit">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</button>

          <div class="hint" style="margin-top:8px;">
            –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–±—Ä–∞—É–∑–µ—Ä) –∏ –≤ Supabase (—Ç–∞–±–ª–∏—Ü–∞ users + –ª–∏—á–Ω—ã–µ –¥–µ–ª–∞).
          </div>
        </form>

        <div class="auth-switch" id="to-login">
          –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <span>–í–æ–π—Ç–∏</span>
        </div>
      </section>

      <section id="login-screen" class="auth-screen">
        <h1>Police Platinum</h1>
        <p class="subtitle">–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –æ—Ñ–∏—Ü–µ—Ä–∞.</p>

        <form id="login-form" novalidate>
          <div class="field">
            <label for="login-nick">–ù–∏–∫</label>
            <input id="login-nick" type="text" placeholder="–ò–º—è_–§–∞–º–∏–ª–∏—è" autocomplete="off" />
            <div class="error" id="login-nick-error"></div>
          </div>

          <div class="field">
            <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
            <input id="login-password" type="password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" />
            <div class="error" id="login-password-error"></div>
          </div>

          <button class="btn" type="submit">–í–æ–π—Ç–∏</button>
        </form>

        <div class="auth-switch" id="to-register">
          –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <span>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>
        </div>
      </section>
    </div>
  </div>

  <!-- ===================== –ü–ê–ù–ï–õ–¨ ===================== -->
  <div id="panel-root" style="display:none;">

    <!-- –ù–∞–≤–±–∞—Ä -->
    <div class="navbar">
      <button class="nav-btn active" id="nav-home">–ì–ª–∞–≤–Ω–∞—è</button>
      <button class="nav-btn" id="nav-files">–õ–∏—á–Ω—ã–µ –¥–µ–ª–∞</button>
      <button class="nav-btn" id="nav-admin" style="display:none;">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>

      <div class="nav-right">
        <button class="back-home-btn" id="back-home-btn" style="display:none;">‚üµ –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>

        <div class="top-user">
          <div class="top-avatar" id="top-avatar">PP</div>
          <div>
            <div class="top-name" id="top-nick">–û—Ñ–∏—Ü–µ—Ä</div>
            <div class="top-role" id="top-role">–†–æ–ª—å</div>
          </div>
        </div>

        <button class="btn-outline btn-sm" id="logout-btn">–í—ã–π—Ç–∏</button>
      </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –ì–ª–∞–≤–Ω–∞—è -->
    <section id="section-home" class="section active">
      <h2>–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
      <p>
        –ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –±–∏–Ω–¥–∞—Ä–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã–º –¥–µ–ª–æ–º –æ—Ñ–∏—Ü–µ—Ä–∞.
      </p>
      <small>
        –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ—å –±–∏–Ω–¥–µ—Ä –∏ –æ—Ñ–æ—Ä–º–∏ —Å–≤–æ—ë –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ. –ï—Å–ª–∏ —Ç—ã –Ω–æ–≤–æ–±—Ä–∞–Ω–µ—Ü ‚Äî –ø—Ä–æ—á–∏—Ç–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        –¥–ª—è —Ä—è–¥–æ–≤—ã—Ö.
      </small>

      <div class="home-actions">
        <button id="download-binder-btn" class="btn">‚¨á –°–∫–∞—á–∞—Ç—å –±–∏–Ω–¥–µ—Ä</button>
        <button id="open-files-from-home" class="btn-outline">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ª–∏—á–Ω—ã–º –¥–µ–ª–∞–º</button>
        <button id="open-rookie-modal" class="btn-outline">–ò–Ω—Ñ–æ –¥–ª—è —Ä—è–¥–æ–≤—ã—Ö</button>
      </div>
    </section>

    <!-- –°–µ–∫—Ü–∏—è: –õ–∏—á–Ω—ã–µ –¥–µ–ª–∞ -->
    <section id="section-files" class="section">
      <h2>–õ–∏—á–Ω—ã–µ –¥–µ–ª–∞</h2>
      <p>
        –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–∏—á–Ω—ã–µ –¥–µ–ª–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –í–∞—à–µ –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ –≤—Å–µ–≥–¥–∞
        –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –≤–≤–µ—Ä—Ö—É —Å–ø–∏—Å–∫–∞. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–µ –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ.
      </p>

      <div class="files-layout">
        <!-- –°–ø–∏—Å–æ–∫ –ª–∏—á–Ω—ã—Ö –¥–µ–ª -->
        <div class="files-list" id="personal-files-list">
          –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ª–∏—á–Ω—ã—Ö –¥–µ–ª...
        </div>

        <!-- –î–µ—Ç–∞–ª–∏ –ª–∏—á–Ω–æ–≥–æ –¥–µ–ª–∞ -->
        <div class="files-detail">
          <div class="files-detail-header">
            <div>
              <strong id="pf-detail-title">–õ–∏—á–Ω–æ–µ –¥–µ–ª–æ</strong>
              <div id="pf-detail-sub" style="font-size:12px; color:var(--muted);"></div>
            </div>
            <div id="pf-edit-badge" class="badge-readonly">
              –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
            </div>
          </div>

          <form id="personal-form" novalidate>
            <div class="field">
              <label for="pf-dept">–û—Ç–¥–µ–ª (—Ñ–æ—Ä—É–º–Ω—ã–π)</label>
              <select id="pf-dept">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª‚Ä¶</option>
                <option value="SWAT">SWAT</option>
                <option value="PD">PD</option>
                <option value="PA">PA</option>
                <option value="CHIEF">CHIEF</option>
                <option value="IAG">IAG</option>
                <option value="Cmdr.SWAT">Cmdr.SWAT</option>
                <option value="DCmdr.SWAT">DCmdr.SWAT</option>
              </select>
            </div>

            <div class="field">
              <label for="pf-nick">–ò–º—è_–§–∞–º–∏–ª–∏—è (–∫–∞–∫ –≤ –∏–≥—Ä–µ)</label>
              <input id="pf-nick" type="text" placeholder="–ò–º—è_–§–∞–º–∏–ª–∏—è" />
            </div>

            <div class="field">
              <label for="pf-account">–ù–æ–º–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)</label>
              <input id="pf-account" type="text" placeholder="522501" />
            </div>

            <div class="field">
              <label for="pf-birth">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
              <input id="pf-birth" type="text" placeholder="01.01.2000" />
            </div>

            <div class="field">
              <label for="pf-badge-link">–ù–æ–º–µ—Ä –∑–Ω–∞—á–∫–∞ / –∞–∫–∫–∞—É–Ω—Ç–∞ (—Å—Å—ã–ª–∫–∞)</label>
              <input id="pf-badge-link" type="text" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç / –ø—Ä–æ—Ñ–∏–ª—å" />
            </div>

            <div class="field">
              <label for="pf-rank">–¢–µ–∫—É—â–µ–µ –∑–≤–∞–Ω–∏–µ</label>
              <input id="pf-rank" type="text" placeholder="–°–µ—Ä–∂–∞–Ω—Ç / –ö–∞–ø–∏—Ç–∞–Ω / ..." />
            </div>

            <div class="field">
              <label for="pf-phone">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
              <input id="pf-phone" type="text" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" />
            </div>

            <div class="field">
              <label for="pf-contact">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ —Å–≤—è–∑–∏</label>
              <input id="pf-contact" type="text" placeholder="VK / Discord" />
            </div>

            <button type="submit" id="save-personal-btn" class="btn" style="margin-top:6px;">
              üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ
            </button>
            <div id="personal-save-note" class="personal-note"></div>
          </form>

          <div class="personal-note" id="pf-readonly-note" style="display:none;">
            –í—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ —á—É–∂–æ–µ –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
          </div>
        </div>
      </div>
    </section>

    <!-- –°–µ–∫—Ü–∏—è: –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
    <section id="section-admin" class="section">
      <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
      <p>
        –†–∞–∑–¥–µ–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
        –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã ("–ö—É—Ä–∞—Ç–æ—Ä", "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É", "–ú–∏–Ω–∏—Å—Ç—Ä"), –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–∞–º–∫—É –∞–≤–∞—Ç–∞—Ä–∫–∏.
        –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Ä–æ–ª–∏ –∏ –∞–≤–∞—Ç–∞—Ä–∫–∏.
      </p>

      <div style="margin-top:10px; margin-bottom:8px;">
        <button id="admin-add-user-btn" class="btn btn-sm" style="display:none;">
          ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </button>
      </div>

      <div id="admin-users-list" class="admin-users-list">
        –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
      </div>
    </section>
  </div>

  <!-- ============ –ú–û–î–ê–õ–ö–ê: –†–Ø–î–û–í–´–ï ============ -->
  <div id="rookie-modal" class="modal-backdrop">
    <div class="modal">
      <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä—è–¥–æ–≤—ã—Ö</h3>
      <p><strong>Police Academy [PA][1-2] ‚Äî –ü–æ–ª–∏—Ü–µ–π—Å–∫–∞—è –∞–∫–∞–¥–µ–º–∏—è</strong></p>
      <p>
        Police Academy [PA][1-2] (–Ω–æ–≤–æ–±—Ä–∞–Ω—Ü—ã) ‚Äî –æ—Ç–¥–µ–ª –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ–π –∞–∫–∞–¥–µ–º–∏–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
        –Ω–æ–≤–∏—á–∫–æ–≤, —Ç–æ–ª—å–∫–æ –≤—Å—Ç—É–ø–∏–≤—à–∏—Ö –≤ —Ä—è–¥—ã –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞. –°—é–¥–∞ –≤—Ö–æ–¥—è—Ç —ç–∫–∑–∞–º–µ–Ω—ã,
        —é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞, –æ–±—É—á–µ–Ω–∏–µ –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—é —Å –æ—Ä—É–∂–∏–µ–º –∏ –ø—Ä–∞–≤–∏–ª–∞–º –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –ø–∞—Ç—Ä—É–ª–µ.
      </p>
      <p>
        –ê–∫–∞–¥–µ–º–∏—è –≥–æ—Ç–æ–≤–∏—Ç –Ω–æ–≤–æ–±—Ä–∞–Ω—Ü–µ–≤ –≤ –æ—Ç–¥–µ–ª –ø–∞—Ç—Ä—É–ª—å–Ω–æ–≥–æ –¥–∏–≤–∏–∑–∏–æ–Ω–∞ (PD), –≤ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∏
        –±—É–¥—É—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —ç–∫–∑–∞–º–µ–Ω–æ–≤.
      </p>
      <p><strong>–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞—Ü–∏–∏:</strong><br/>
        –ü–æ–∑—ã–≤–Ω–æ–π Police Academy: <code>[PA]</code><br/>
        –ü—Ä–∏–º–µ—Ä: <code>![PA] –ü—Ä–∏–µ–º...</code>
      </p>
      <p><strong>–û—Ç—ã–≥—Ä–æ–≤–∫–∞ –∑–Ω–∞—á–∫–∞ (–ø—Ä–∏–º–µ—Ä):</strong><br/>
        <code>/me –ù–∞ –ø–æ—è—Å–µ –∑–Ω–∞—á–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ–π –∞–∫–∞–¥–µ–º–∏–∏ LVPD —Å –Ω–æ–º–µ—Ä–æ–º [–Ω–æ–º–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö]</code>
      </p>

      <div class="modal-footer">
        <button class="btn btn-sm" id="rookie-close-btn">–ü–æ–Ω—è–ª, –ø—Ä–∏–Ω—è–ª</button>
      </div>
    </div>
  </div>

  <!-- ============ –ú–û–î–ê–õ–ö–ê: –î–û–ë–ê–í–ò–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–ê–î–ú–ò–ù) ============ -->
  <div id="admin-add-modal" class="modal-backdrop">
    <div class="modal">
      <h3>–î–æ–±–∞–≤–∏—Ç—å / –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
      <p style="font-size:12px; color:var(--muted);">
        –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞, –∑–∞—Ç–µ–º –∑–∞–¥–∞–π—Ç–µ –µ–º—É —Å—Ç–∞—Ç—É—Å –∏ —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞.
      </p>

      <input id="admin-add-search" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É..." />

      <div id="admin-add-results" style="max-height:220px; overflow-y:auto; margin-bottom:8px;">
        <!-- —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
      </div>

      <div class="field">
        <label for="admin-status-select">–°—Ç–∞—Ç—É—Å</label>
        <select id="admin-status-select" class="admin-select">
          <option value="">–ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞</option>
          <option value="–ö—É—Ä–∞—Ç–æ—Ä">–ö—É—Ä–∞—Ç–æ—Ä</option>
          <option value="–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É</option>
          <option value="–ú–∏–Ω–∏—Å—Ç—Ä">–ú–∏–Ω–∏—Å—Ç—Ä</option>
        </select>
      </div>

      <div class="field">
        <label for="admin-border-color">–¶–≤–µ—Ç —Ä–∞–º–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏</label>
        <input id="admin-border-color" type="color" class="admin-color" value="#3a7ca5" />
      </div>

      <div class="modal-footer">
        <button class="btn-outline btn-sm" id="admin-add-cancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-sm" id="admin-add-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

</div> <!-- /app -->
<script>
/* ================================
   ‚≠ê –ß–ê–°–¢–¨ 2 / 3 ‚Äî JAVASCRIPT –û–°–ù–û–í–ê
   ================================ */

/* ---------- 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE ---------- */

const SUPABASE_URL = "https://YOUR-PROJECT-url.supabase.co";
const SUPABASE_KEY = "YOUR-ANON-KEY";

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);


/* ---------- 2. –£–¢–ò–õ–ò–¢–´ ---------- */

function normalizeNick(n) {
  if (!n) return "";
  return n.trim().replace(/\s+/g, "_");
}

function showError(el, msg) {
  document.getElementById(el).textContent = msg || "";
}


/* ---------- 3. –•–†–ê–ù–ï–ù–ò–ï –°–ï–°–°–ò–ò –í LOCALSTORAGE ---------- */

function saveSession(userObj) {
  localStorage.setItem("pp_user", JSON.stringify(userObj));
}

function loadSession() {
  try {
    return JSON.parse(localStorage.getItem("pp_user"));
  } catch {
    return null;
  }
}

function clearSession() {
  localStorage.removeItem("pp_user");
}


/* ---------- 4. –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ---------- */

const authRoot = document.getElementById("auth-root");
const panelRoot = document.getElementById("panel-root");

const regScreen = document.getElementById("register-screen");
const loginScreen = document.getElementById("login-screen");

document.getElementById("to-login").onclick = () => {
  regScreen.classList.remove("active");
  loginScreen.classList.add("active");
};

document.getElementById("to-register").onclick = () => {
  loginScreen.classList.remove("active");
  regScreen.classList.add("active");
};


/* ---------- 5. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ---------- */

document.getElementById("register-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  let nick = normalizeNick(document.getElementById("reg-nick").value);
  let password = document.getElementById("reg-password").value;
  let dept = document.getElementById("reg-dept").value;
  let avatarFile = document.getElementById("reg-avatar").files[0];

  showError("reg-nick-error", "");
  showError("reg-password-error", "");
  showError("reg-dept-error", "");
  showError("reg-avatar-error", "");

  if (!nick || !/^[A-Za-z]+_[A-Za-z]+$/.test(nick)) {
    showError("reg-nick-error", "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–∏–∫ (–ò–º—è_–§–∞–º–∏–ª–∏—è)");
    return;
  }
  if (!password || password.length < 6) {
    showError("reg-password-error", "–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π");
    return;
  }
  if (!dept) {
    showError("reg-dept-error", "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç");
    return;
  }
  if (!avatarFile) {
    showError("reg-avatar-error", "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É");
    return;
  }

  // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –≤ base64
  const reader = new FileReader();
  reader.onload = async () => {
    const base64 = reader.result;

    const fileName = `${nick}_${Date.now()}.png`;

    const { data: uploadData, error: uploadError } =
      await supabaseClient.storage.from("avatars")
        .upload(fileName, avatarFile, { upsert: true });

    if (uploadError) {
      alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏");
      console.log(uploadError);
      return;
    }

    const { data: urlData } = supabaseClient
      .storage
      .from("avatars")
      .getPublicUrl(fileName);

    const avatarURL = urlData.publicUrl;

    const { data, error } = await supabaseClient
      .from("users")
      .insert({
        nick: nick,
        password_hash: password,
        department: dept,
        avatar_url: avatarURL,
        role: "user",
        border_color: "#3a7ca5",
        status: ""
      })
      .select("*")
      .single();

    if (error) {
      alert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏");
      console.log(error);
      return;
    }

    saveSession(data);
    loadPanelUI(data);
  };
  reader.readAsDataURL(avatarFile);
});


/* ---------- 6. –í–•–û–î ---------- */

document.getElementById("login-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  let nick = normalizeNick(document.getElementById("login-nick").value);
  let password = document.getElementById("login-password").value;

  showError("login-nick-error", "");
  showError("login-password-error", "");

  if (!nick) {
    showError("login-nick-error", "–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫");
    return;
  }
  if (!password) {
    showError("login-password-error", "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å");
    return;
  }

  const { data, error } = await supabaseClient
    .from("users")
    .select("*")
    .eq("nick", nick)
    .single();

  if (error || !data) {
    showError("login-nick-error", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
    return;
  }

  if (data.password_hash !== password) {
    showError("login-password-error", "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
    return;
  }

  saveSession(data);
  loadPanelUI(data);
});


/* ---------- 7. –ó–ê–ì–†–£–ó–ö–ê –ü–ê–ù–ï–õ–ò ---------- */

function loadPanelUI(user) {
  authRoot.style.display = "none";
  panelRoot.style.display = "block";

  document.getElementById("top-nick").textContent = user.nick;
  document.getElementById("top-role").textContent =
    user.role === "admin"
      ? "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
      : user.role === "moderator"
      ? "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä"
      : "–û—Ñ–∏—Ü–µ—Ä";

  const avatarBox = document.getElementById("top-avatar");
  avatarBox.innerHTML = "";
  avatarBox.style.borderColor = user.border_color || "#3a7ca5";

  if (user.avatar_url) {
    const img = document.createElement("img");
    img.src = user.avatar_url;
    avatarBox.appendChild(img);
  } else {
    avatarBox.textContent = user.nick[0];
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∫–∏
  if (user.role === "admin" || user.role === "moderator") {
    document.getElementById("nav-admin").style.display = "block";
  }

  switchSection("home");
}


/* ---------- 8. –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–ï–°–°–ò–ò ---------- */

window.addEventListener("load", () => {
  const session = loadSession();
  if (session) loadPanelUI(session);
});


/* ---------- 9. –í–´–•–û–î ---------- */

document.getElementById("logout-btn").onclick = () => {
  clearSession();
  location.reload();
};


/* ---------- 10. –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –†–ê–ó–î–ï–õ–ê–ú ---------- */

function switchSection(name) {
  const sections = ["home", "files", "admin"];
  sections.forEach(sec => {
    document.getElementById(`section-${sec}`).classList.remove("active");
    document.getElementById(`nav-${sec}`).classList.remove("active");
  });

  document.getElementById(`section-${name}`).classList.add("active");
  document.getElementById(`nav-${name}`).classList.add("active");

  // –∫–Ω–æ–ø–∫–∞ "–ù–∞ –≥–ª–∞–≤–Ω—É—é"
  document.getElementById("back-home-btn").style.display =
    name === "home" ? "none" : "inline-block";

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ª–∏—á–Ω—ã—Ö –¥–µ–ª
  if (name === "files") loadPersonalFiles();

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω–∫–∏
  if (name === "admin") loadAdminPanel();
}


/* –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
document.getElementById("nav-home").onclick = () => switchSection("home");
document.getElementById("nav-files").onclick = () => switchSection("files");
document.getElementById("nav-admin").onclick = () => switchSection("admin");

document.getElementById("back-home-btn").onclick = () => switchSection("home");

</script>
  <script>
/* ===========================================
   –ß–ê–°–¢–¨ 3 ‚Äî –õ–ò–ß–ù–´–ï –î–ï–õ–ê + –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
   =========================================== */

let currentUser = null;
let personalFilesCache = [];
let currentFileId = null;
let currentFileOwnerId = null;
let currentFileEditable = false;

let adminUsersCache = [];
let adminSelectedUserId = null;

/* ---------- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º loadPanelUI + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ø-–±–∞—Ä–∞ ---------- */

function refreshTopBar() {
  if (!currentUser) return;

  const roleLabel =
    currentUser.role === "admin"
      ? "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
      : currentUser.role === "moderator"
      ? "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä"
      : "–û—Ñ–∏—Ü–µ—Ä";

  document.getElementById("top-nick").textContent = currentUser.nick || "–û—Ñ–∏—Ü–µ—Ä";
  document.getElementById("top-role").textContent = roleLabel;

  const avatarBox = document.getElementById("top-avatar");
  avatarBox.innerHTML = "";
  avatarBox.style.borderColor = currentUser.border_color || "#3a7ca5";

  if (currentUser.avatar_url) {
    const img = document.createElement("img");
    img.src = currentUser.avatar_url;
    avatarBox.appendChild(img);
  } else {
    avatarBox.textContent = currentUser.nick ? currentUser.nick[0] : "P";
  }

  // –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω–∫—É
  const navAdmin = document.getElementById("nav-admin");
  if (currentUser.role === "admin" || currentUser.role === "moderator") {
    navAdmin.style.display = "inline-block";
  } else {
    navAdmin.style.display = "none";
  }
}

// –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –ß–∞—Å—Ç–∏ 2 (—ç—Ç–∞ –≤–µ—Ä—Å–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è)
function loadPanelUI(user) {
  currentUser = user;
  saveSession(user);

  authRoot.style.display = "none";
  panelRoot.style.display = "block";

  refreshTopBar();
  switchSection("home");
}

/* –°–µ—Å—Å–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–∑ –ß.2) */
window.addEventListener("load", () => {
  const session = loadSession();
  if (session) {
    currentUser = session;
    loadPanelUI(session);
  }
});

/* ---------- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å —É—á—ë—Ç–æ–º –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π ---------- */

function switchSection(name) {
  const sections = ["home", "files", "admin"];
  sections.forEach((sec) => {
    document.getElementById(`section-${sec}`).classList.remove("active");
    document.getElementById(`nav-${sec}`).classList.remove("active");
  });

  document.getElementById(`section-${name}`).classList.add("active");
  document.getElementById(`nav-${name}`).classList.add("active");

  // –∫–Ω–æ–ø–∫–∞ "–ù–∞ –≥–ª–∞–≤–Ω—É—é"
  document.getElementById("back-home-btn").style.display =
    name === "home" ? "none" : "inline-block";

  if (name === "files") {
    loadPersonalFiles();
  }
  if (name === "admin") {
    loadAdminPanel();
  }
}

// –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ)
document.getElementById("nav-home").onclick = () => switchSection("home");
document.getElementById("nav-files").onclick = () => switchSection("files");
document.getElementById("nav-admin").onclick = () => switchSection("admin");
document.getElementById("back-home-btn").onclick = () => switchSection("home");

/* –ö–Ω–æ–ø–∫–∏ —Å –≥–ª–∞–≤–Ω–æ–π */
document.getElementById("open-files-from-home").onclick = () => switchSection("files");

/* ---------- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Ä—è–¥–æ–≤—ã—Ö ---------- */

const rookieModal = document.getElementById("rookie-modal");
document.getElementById("open-rookie-modal").onclick = () => {
  rookieModal.classList.add("active");
};
document.getElementById("rookie-close-btn").onclick = () => {
  rookieModal.classList.remove("active");
};

/* ===========================================
   –õ–ò–ß–ù–´–ï –î–ï–õ–ê
   =========================================== */

const filesListEl = document.getElementById("personal-files-list");
const pfForm = document.getElementById("personal-form");
const pfDept = document.getElementById("pf-dept");
const pfNick = document.getElementById("pf-nick");
const pfAccount = document.getElementById("pf-account");
const pfBirth = document.getElementById("pf-birth");
const pfBadgeLink = document.getElementById("pf-badge-link");
const pfRank = document.getElementById("pf-rank");
const pfPhone = document.getElementById("pf-phone");
const pfContact = document.getElementById("pf-contact");
const pfSaveBtn = document.getElementById("save-personal-btn");
const pfSaveNote = document.getElementById("personal-save-note");
const pfReadonlyNote = document.getElementById("pf-readonly-note");
const pfDetailTitle = document.getElementById("pf-detail-title");
const pfDetailSub = document.getElementById("pf-detail-sub");
const pfEditBadge = document.getElementById("pf-edit-badge");

// –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫
function updatePfHeaderPreview() {
  const dept = pfDept.value || "–û—Ç–¥–µ–ª";
  const nick = pfNick.value || "–ò–º—è_–§–∞–º–∏–ª–∏—è";
  const acc = pfAccount.value || "–ù–æ–º–µ—Ä";
  pfDetailTitle.textContent = `[${dept}] ${nick} [${acc}]`;
}

pfDept.addEventListener("change", updatePfHeaderPreview);
pfNick.addEventListener("input", updatePfHeaderPreview);
pfAccount.addEventListener("input", () => {
  pfAccount.value = pfAccount.value.replace(/\D+/g, "");
  updatePfHeaderPreview();
});

// –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
function fillPersonalForm(fileRow, editable) {
  if (!fileRow) {
    // –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —à–∞–±–ª–æ–Ω –¥–ª—è —Å–≤–æ–µ–≥–æ –õ–î
    pfDept.value = "";
    pfNick.value = currentUser ? currentUser.nick : "";
    pfAccount.value = "";
    pfBirth.value = "";
    pfBadgeLink.value = "";
    pfRank.value = "";
    pfPhone.value = "";
    pfContact.value = "";
    pfDetailSub.textContent = "–ù–æ–≤–æ–µ –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ";
    updatePfHeaderPreview();
  } else {
    pfDept.value = fileRow.forum_dept || "";
    pfNick.value = fileRow.forum_nick || "";
    pfAccount.value = fileRow.account_number || "";
    pfBirth.value = fileRow.birth_date || "";
    pfBadgeLink.value = fileRow.badge_link || "";
    pfRank.value = fileRow.rank || "";
    pfPhone.value = fileRow.phone || "";
    pfContact.value = fileRow.contact || "";

    pfDetailSub.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${
      fileRow.updated_at
        ? new Date(fileRow.updated_at).toLocaleString()
        : "‚Äî"
    }`;
    updatePfHeaderPreview();
  }

  // –≤–∫–ª—é—á–∞–µ–º/–≤—ã–∫–ª—é—á–∞–µ–º –ø–æ–ª—è
  const controls = [
    pfDept, pfNick, pfAccount, pfBirth,
    pfBadgeLink, pfRank, pfPhone, pfContact
  ];
  controls.forEach((el) => (el.disabled = !editable));
  pfSaveBtn.style.display = editable ? "inline-block" : "none";

  if (editable) {
    pfEditBadge.textContent = "–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å";
    pfEditBadge.className = "badge-editable";
    pfReadonlyNote.style.display = "none";
  } else {
    pfEditBadge.textContent = "–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä";
    pfEditBadge.className = "badge-readonly";
    pfReadonlyNote.style.display = "block";
  }
}

// –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –õ–î
function openPersonalFile(id) {
  const file = personalFilesCache.find((f) => f.id === id);
  if (!file) return;

  currentFileId = file.id;
  currentFileOwnerId = file.user_id;
  const canEdit =
    currentUser &&
    (currentUser.role === "admin" ||
      currentUser.role === "moderator" ||
      currentUser.id === file.user_id);

  currentFileEditable = !!canEdit;

  // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤ —Å–ø–∏—Å–∫–µ
  const items = filesListEl.querySelectorAll(".file-item");
  items.forEach((item) => {
    item.classList.toggle("active", Number(item.dataset.id) === id);
  });

  fillPersonalForm(file, canEdit);
}

// –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ª–∏—á–Ω—ã—Ö –¥–µ–ª
async function loadPersonalFiles(selectId) {
  if (!currentUser) return;

  filesListEl.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ª–∏—á–Ω—ã—Ö –¥–µ–ª...";

  const { data, error } = await supabaseClient
    .from("personal_files")
    .select("*")
    .order("updated_at", { ascending: false });

  if (error) {
    console.error(error);
    filesListEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏—á–Ω—ã—Ö –¥–µ–ª.";
    return;
  }

  personalFilesCache = data || [];
  filesListEl.innerHTML = "";

  if (!personalFilesCache.length) {
    filesListEl.textContent =
      "–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ª–∏—á–Ω–æ–≥–æ –¥–µ–ª–∞. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Å–ø—Ä–∞–≤–∞, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—ë.";
    currentFileId = null;
    currentFileOwnerId = currentUser.id;
    currentFileEditable = true;
    fillPersonalForm(null, true);
    return;
  }

  const myFiles = personalFilesCache.filter(
    (f) => f.user_id === currentUser.id
  );
  const others = personalFilesCache.filter(
    (f) => f.user_id !== currentUser.id
  ).sort((a, b) =>
    (a.forum_nick || "").localeCompare(b.forum_nick || "", "ru")
  );

  const ordered = [...myFiles, ...others];

  ordered.forEach((file) => {
    const item = document.createElement("div");
    item.className = "file-item";
    if (file.user_id === currentUser.id) item.classList.add("me");
    item.dataset.id = file.id;

    const title = document.createElement("div");
    title.className = "file-title";
    const dept = file.forum_dept || "–û—Ç–¥–µ–ª";
    const nick = file.forum_nick || "–ò–º—è_–§–∞–º–∏–ª–∏—è";
    const acc = file.account_number || "–Ω–æ–º–µ—Ä";
    title.textContent = `[${dept}] ${nick} [${acc}]`;

    const meta = document.createElement("div");
    meta.className = "file-meta";
    meta.textContent = file.rank
      ? `–ó–≤–∞–Ω–∏–µ: ${file.rank}`
      : "–ó–≤–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ";

    item.appendChild(title);
    item.appendChild(meta);

    item.onclick = () => {
      openPersonalFile(file.id);
    };

    filesListEl.appendChild(item);
  });

  let initialId = null;
  if (selectId) {
    initialId = selectId;
  } else if (myFiles.length) {
    initialId = myFiles[0].id;
  } else if (ordered.length) {
    initialId = ordered[0].id;
  }

  if (initialId) {
    openPersonalFile(initialId);
  }
}

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –õ–î
pfForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  if (!currentUser) return;

  pfSaveNote.textContent = "";
  pfSaveNote.style.color = "#9ca3af";

  if (!currentFileEditable) {
    pfSaveNote.style.color = "#f97373";
    pfSaveNote.textContent = "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ª–∏—á–Ω–æ–≥–æ –¥–µ–ª–∞.";
    return;
  }

  const dept = pfDept.value.trim();
  const nick = pfNick.value.trim();
  const acc = pfAccount.value.trim();

  if (!dept || !nick || !acc) {
    pfSaveNote.style.color = "#f97373";
    pfSaveNote.textContent = "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –º–∏–Ω–∏–º—É–º: –û—Ç–¥–µ–ª, –ò–º—è_–§–∞–º–∏–ª–∏—è –∏ –Ω–æ–º–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞.";
    return;
  }

  const payload = {
    forum_dept: dept,
    forum_nick: nick,
    account_number: acc,
    birth_date: pfBirth.value.trim(),
    badge_link: pfBadgeLink.value.trim(),
    rank: pfRank.value.trim(),
    phone: pfPhone.value.trim(),
    contact: pfContact.value.trim(),
  };

  let result;
  if (currentFileId) {
    result = await supabaseClient
      .from("personal_files")
      .update(payload)
      .eq("id", currentFileId)
      .select("*")
      .single();
  } else {
    payload.user_id = currentFileOwnerId || currentUser.id;
    result = await supabaseClient
      .from("personal_files")
      .insert(payload)
      .select("*")
      .single();
  }

  const { data, error } = result;
  if (error) {
    console.error(error);
    pfSaveNote.style.color = "#f97373";
    pfSaveNote.textContent = "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏—á–Ω–æ–≥–æ –¥–µ–ª–∞.";
    return;
  }

  currentFileId = data.id;
  currentFileOwnerId = data.user_id;

  pfSaveNote.style.color = "#22c55e";
  pfSaveNote.textContent = "–õ–∏—á–Ω–æ–µ –¥–µ–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.";
  setTimeout(() => (pfSaveNote.textContent = ""), 2500);

  await loadPersonalFiles(currentFileId);
});

/* ===========================================
   –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
   =========================================== */

const adminUsersListEl = document.getElementById("admin-users-list");
const adminAddBtn = document.getElementById("admin-add-user-btn");
const adminAddModal = document.getElementById("admin-add-modal");
const adminAddSearchInput = document.getElementById("admin-add-search");
const adminAddResults = document.getElementById("admin-add-results");
const adminStatusSelect = document.getElementById("admin-status-select");
const adminBorderColor = document.getElementById("admin-border-color");
const adminAddCancel = document.getElementById("admin-add-cancel");
const adminAddSave = document.getElementById("admin-add-save");

// –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function loadAdminPanel() {
  if (!currentUser || (currentUser.role !== "admin" && currentUser.role !== "moderator")) {
    adminUsersListEl.textContent = "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.";
    adminAddBtn.style.display = "none";
    return;
  }

  adminUsersListEl.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...";
  adminAddBtn.style.display = currentUser.role === "admin" ? "inline-block" : "none";

  const { data, error } = await supabaseClient
    .from("users")
    .select("id, nick, department, role, avatar_url, created_at, status, border_color")
    .order("created_at", { ascending: true });

  if (error) {
    console.error(error);
    adminUsersListEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.";
    return;
  }

  adminUsersCache = data || [];
  renderAdminUsers();
}

function roleLabel(role) {
  if (role === "admin") return "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä";
  if (role === "moderator") return "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä";
  return "–û—Ñ–∏—Ü–µ—Ä";
}

function renderAdminUsers() {
  adminUsersListEl.innerHTML = "";

  if (!adminUsersCache.length) {
    adminUsersListEl.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.";
    return;
  }

  adminUsersCache.forEach((user) => {
    const card = document.createElement("div");
    card.className = "admin-user-card";

    const avatar = document.createElement("div");
    avatar.className = "admin-user-avatar";
    avatar.style.borderColor = user.border_color || "#3a7ca5";
    if (user.avatar_url) {
      const img = document.createElement("img");
      img.src = user.avatar_url;
      avatar.appendChild(img);
    } else {
      avatar.textContent = user.nick ? user.nick[0] : "?";
    }

    const main = document.createElement("div");
    main.className = "admin-user-main";

    const header = document.createElement("div");
    header.className = "admin-user-header";

    const nickEl = document.createElement("div");
    nickEl.className = "admin-user-nick";
    nickEl.textContent = user.nick;

    const roleBadge = document.createElement("div");
    roleBadge.className = "admin-role-badge " + (user.role || "user");
    roleBadge.textContent = roleLabel(user.role || "user");

    header.appendChild(nickEl);
    header.appendChild(roleBadge);

    const meta = document.createElement("div");
    meta.className = "admin-user-meta";

    if (user.role === "admin" && user.status) {
      meta.textContent = `–°—Ç–∞—Ç—É—Å: ${user.status}`;
    } else if (user.role === "admin" && !user.status) {
      meta.textContent = "–°—Ç–∞—Ç—É—Å: –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω";
    } else {
      meta.textContent = `–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç: ${user.department || "‚Äî"}`;
    }

    const created = document.createElement("div");
    created.className = "admin-user-meta";
    created.textContent = user.created_at
      ? `–°–æ–∑–¥–∞–Ω: ${new Date(user.created_at).toLocaleString()}`
      : "";

    const actions = document.createElement("div");
    actions.className = "admin-user-actions";

    // —Å–µ–ª–µ–∫—Ç —Å—Ç–∞—Ç—É—Å–∞
    const statusSelect = document.createElement("select");
    statusSelect.className = "admin-select";
    ["", "–ö—É—Ä–∞—Ç–æ—Ä", "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É", "–ú–∏–Ω–∏—Å—Ç—Ä"].forEach((val) => {
      const opt = document.createElement("option");
      opt.value = val;
      opt.textContent = val || "–ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞";
      statusSelect.appendChild(opt);
    });
    statusSelect.value = user.status || "";

    // —Ü–≤–µ—Ç —Ä–∞–º–∫–∏
    const colorInput = document.createElement("input");
    colorInput.type = "color";
    colorInput.className = "admin-color";
    colorInput.value = user.border_color || "#3a7ca5";

    // —Å–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞
    const avatarInput = document.createElement("input");
    avatarInput.type = "file";
    avatarInput.accept = "image/*";
    avatarInput.className = "admin-avatar-input";

    const isAdmin = currentUser && currentUser.role === "admin";

    if (!isAdmin) {
      statusSelect.disabled = true;
      colorInput.disabled = true;
      avatarInput.disabled = true;
    }

    if (isAdmin) {
      statusSelect.onchange = async () => {
        await updateUserFields(user.id, { status: statusSelect.value });
      };
      colorInput.onchange = async () => {
        await updateUserFields(user.id, { border_color: colorInput.value });
      };
      avatarInput.onchange = async () => {
        const file = avatarInput.files[0];
        if (!file) return;
        await adminChangeAvatarForUser(user, file);
      };
    }

    actions.appendChild(statusSelect);
    actions.appendChild(colorInput);
    actions.appendChild(avatarInput);

    main.appendChild(header);
    main.appendChild(meta);
    if (created.textContent) main.appendChild(created);
    main.appendChild(actions);

    card.appendChild(avatar);
    card.appendChild(main);

    adminUsersListEl.appendChild(card);
  });
}

async function updateUserFields(userId, patch) {
  const { data, error } = await supabaseClient
    .from("users")
    .update(patch)
    .eq("id", userId)
    .select("*")
    .single();

  if (error) {
    console.error(error);
    alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
    return;
  }

  // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à
  const idx = adminUsersCache.findIndex((u) => u.id === userId);
  if (idx >= 0) adminUsersCache[idx] = data;

  // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–∏–ª–∏ —Å–µ–±—è
  if (currentUser && currentUser.id === userId) {
    currentUser = { ...currentUser, ...patch };
    saveSession(currentUser);
    refreshTopBar();
  }

  renderAdminUsers();
}

async function adminChangeAvatarForUser(user, file) {
  try {
    const fileName = `${user.nick}_${Date.now()}.png`;
    const { data: uploadData, error: uploadError } = await supabaseClient
      .storage.from("avatars")
      .upload(fileName, file, { upsert: true });

    if (uploadError) {
      console.error(uploadError);
      alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞");
      return;
    }

    const { data: urlData } = supabaseClient
      .storage.from("avatars")
      .getPublicUrl(fileName);

    const avatarURL = urlData.publicUrl;
    await updateUserFields(user.id, { avatar_url: avatarURL });
  } catch (e) {
    console.error(e);
    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞–≤–∞—Ç–∞—Ä–∞");
  }
}

/* ---------- –ú–æ–¥–∞–ª–∫–∞ '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' (–Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ ‚Äî –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å/—Ä–∞–º–∫—É) ---------- */

function openAdminAddModal() {
  if (!currentUser || currentUser.role !== "admin") return;
  adminSelectedUserId = null;
  adminAddSearchInput.value = "";
  renderAdminAddResults("");
  adminStatusSelect.value = "";
  adminBorderColor.value = "#3a7ca5";
  adminAddModal.classList.add("active");
}

function closeAdminAddModal() {
  adminAddModal.classList.remove("active");
}

function renderAdminAddResults(filterText) {
  adminAddResults.innerHTML = "";

  const text = (filterText || "").toLowerCase();
  const list = adminUsersCache.filter((u) =>
    !text ? true : (u.nick || "").toLowerCase().includes(text)
  );

  if (!list.length) {
    adminAddResults.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.";
    return;
  }

  list.forEach((u) => {
    const item = document.createElement("div");
    item.className = "search-result-item";
    item.dataset.id = u.id;
    item.textContent = `${u.nick} (${roleLabel(u.role)})`;
    if (adminSelectedUserId === u.id) {
      item.style.background = "#415a77";
    }

    item.onclick = () => {
      adminSelectedUserId = u.id;
      adminStatusSelect.value = u.status || "";
      adminBorderColor.value = u.border_color || "#3a7ca5";
      renderAdminAddResults(text);
    };

    adminAddResults.appendChild(item);
  });
}

adminAddBtn.onclick = openAdminAddModal;
adminAddCancel.onclick = closeAdminAddModal;

adminAddSearchInput.addEventListener("input", (e) => {
  renderAdminAddResults(e.target.value);
});

adminAddSave.onclick = async () => {
  if (!adminSelectedUserId) {
    alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.");
    return;
  }
  const status = adminStatusSelect.value;
  const color = adminBorderColor.value || "#3a7ca5";

  await updateUserFields(adminSelectedUserId, {
    status,
    border_color: color,
  });

  closeAdminAddModal();
};

// –Ω–µ–±–æ–ª—å—à–æ–π —Ñ–∏–∫—Å: –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞—é—Ç
</script>
