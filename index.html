<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Police Platinum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ===== –í–°–¢–ê–í–ò–¢–¨ CSS –°–Æ–î–ê ===== -->
  <style id="css-here">
  {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: system-ui, sans-serif;
  }

    body {
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .auth-screen { display: none; }
    .auth-screen.active { display: block; }
    
    .app-card {
      background: #1e293b;
      padding: 20px;
      width: 360px;
      border-radius: 14px;
      box-shadow: 0 0 25px rgba(0,0,0,.45);
    }
    
    .badge {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: linear-gradient(135deg, #facc15, #e11d48);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    /* ----- FORM ----- */
    .field {
      margin-bottom: 14px;
      display: flex;
      flex-direction: column;
    }
    
    .field label {
      font-size: 14px;
      margin-bottom: 6px;
    }
    
    .field input, .field select {
      padding: 8px;
      background: #0f172a;
      border: 1px solid #475569;
      color: white;
      border-radius: 8px;
    }
    
    .btn {
      width: 100%;
      padding: 10px;
      background: #2563eb;
      border: none;
      border-radius: 8px;
      color: white;
      margin-top: 10px;
      cursor: pointer;
    }
    .btn:hover { background: #1d4ed8; }
    
    /* ----- –ü–ê–ù–ï–õ–¨ ----- */
    #panel-root {
      display: none;
      width: 100%;
    }
    
    .frame {
      display: grid;
      grid-template-columns: 220px 1fr;
      width: 100%;
      max-width: 1200px;
      background: #1e293b;
      border-radius: 14px;
      overflow: hidden;
    }
    
    .sidebar {
      background: #111827;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      border-right: 1px solid #334155;
    }
    
    .nav-btn {
      padding: 10px;
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 8px;
      color: #e2e8f0;
      cursor: pointer;
      text-align: left;
    }
    .nav-btn:hover { background: #334155; }
    
    /* ----- –°–ï–°–°–ò–Ø ----- */
    .logout {
      margin-top: auto;
      background: #ef4444;
    }
    .logout:hover { background: #dc2626; }
    
    /* ----- –°–ï–ö–¶–ò–ò ----- */
    .panel-section {
      padding: 20px;
    }
    
    #section-personal .pf-item {
      padding: 10px;
      border: 1px solid #334155;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
    }
    #section-personal .pf-item:hover {
      background: #334155;
    }
    
    .pf-view {
      padding: 20px;
      background: #0f172a;
      border-radius: 10px;
      border: 1px solid #334155;
    }
    
    /* ----- –õ–ò–î–ï–†–´ ----- */
    .leader-card {
      padding: 12px;
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .leader-name {
      font-size: 18px;
    }
    .leader-notes {
      margin-top: 6px;
      font-size: 13px;
    }
    
    /* ----- –ú–û–î–ê–õ–ö–ê ----- */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.65);
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    .modal-backdrop.active { display: flex; }
    
    .modal {
      background: #1e293b;
      padding: 18px;
      width: 360px;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(0,0,0,.6);
    }
    
    .modal input {
      margin-bottom: 10px;
      padding: 8px;
      width: 100%;
      background: #0f172a;
      border-radius: 8px;
      border: 1px solid #475569;
      color: white;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 12px;
    }
    
    .modal-btn {
      padding: 8px 12px;
      border-radius: 6px;
      background: #334155;
      border: none;
      cursor: pointer;
      color: white;
    }
    .modal-btn.primary {
      background: #2563eb;
    }
  </style>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- ======= –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ======= -->
<div id="auth-root">
  <div class="app-card">
    <div class="badge">PD</div>

    <h1>Police Platinum</h1>
    <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ PD</div>

    <div id="auth-login" class="auth-screen active">
      <form>
        <div class="field">
          <label>–ù–∏–∫</label>
          <input type="text" id="login-nick">
        </div>
        <div class="field">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="login-pass">
        </div>
        <button type="button" id="login-btn" class="btn">–í–æ–π—Ç–∏</button>
      </form>
    </div>

    <div id="auth-register" class="auth-screen">
      <form>
        <div class="field">
          <label>–ù–∏–∫</label>
          <input type="text" id="reg-nick">
        </div>
        <div class="field">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="reg-pass">
        </div>
        <div class="field">
          <label>–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</label>
          <select id="reg-dept">
            <option>LSPD</option>
            <option>SFPD</option>
            <option>LVPD</option>
          </select>
        </div>
        <button type="button" id="reg-btn" class="btn">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      </form>
    </div>
  </div>
</div>


<!-- ======= –û–°–ù–û–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ ======= -->
<div id="panel-root">
  <div class="frame">
    
    <!-- ===== –õ–ï–í–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== -->
    <aside class="sidebar">
      <div id="user-nick" class="user-nick"></div>
      <div id="user-role" class="user-role"></div>

      <button class="nav-btn" id="btn-home" onclick="openTab('home')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
      <button class="nav-btn" id="btn-personal" onclick="openTab('personal')">üìÇ –õ–∏—á–Ω—ã–µ –¥–µ–ª–∞</button>
      <button class="nav-btn" id="btn-leadership" onclick="openTab('leadership')">üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª–∏—Ü–∏–∏</button>

      <button id="logout" class="btn logout">–í—ã–π—Ç–∏</button>
    </aside>

    <!-- ===== –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ (–ö–û–ù–¢–ï–ù–¢ –°–ï–ö–¶–ò–ò) ===== -->
    <main id="panel-content">
      <section id="section-home" class="panel-section">
        <h2>–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ PD!</p>
      </section>

      <section id="section-personal" class="panel-section" style="display:none"></section>

      <section id="section-leadership" class="panel-section" style="display:none"></section>
    </main>

  </div>
</div>


<!-- ===== –ú–û–î–ê–õ–ö–ê –î–õ–Ø –õ–ò–î–ï–†–û–í ===== -->
<div id="leader-edit-modal" class="modal-backdrop">
  <div class="modal">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π</h3>

    <input type="text" id="led-note1" placeholder="–ü–æ–¥–ø–∏—Å—å 1">
    <input type="text" id="led-note2" placeholder="–ü–æ–¥–ø–∏—Å—å 2">
    <input type="text" id="led-note3" placeholder="–ü–æ–¥–ø–∏—Å—å 3">

    <label>–¶–≤–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π</label>
    <input type="color" id="led-color" class="modal-color">

    <div class="modal-footer">
      <button class="modal-btn" onclick="closeLeaderEdit()">–û—Ç–º–µ–Ω–∞</button>
      <button class="modal-btn primary" onclick="saveLeaderNotes()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- ===== –í–°–¢–ê–í–ò–¢–¨ JS –ß–ê–°–¢–¨ 1 –°–Æ–î–ê ===== -->
<script id="js-part1"></script>
const SUPABASE_URL = "https://qjbhflpoelgusfhymipi.supabase.co";
const SUPABASE_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqYmhmbHBvZWxndXNmaHltaXBpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NzEzODMsImV4cCI6MjA4MDQ0NzM4M30.OUBE062cKr4p4KpKlZlWIYCmqCBpXK43tQq9m-laDfg";

const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let CURRENT_USER = null;

function normalizeNick(n) {
  if (!n) return null;
  n = n.trim().replace(/[^A-Za-z–ê-–Ø–∞-—è–Å—ë_]/g, "");
  if (!n.includes("_")) return null;
  let [a, b] = n.split("_");
  if (!a || !b) return null;
  return a.charAt(0).toUpperCase() + a.slice(1).toLowerCase() + "_" +
         b.charAt(0).toUpperCase() + b.slice(1).toLowerCase();
}

async function userExists(nick) {
  let { data } = await db.from("users").select("id").eq("nick", nick);
  return data && data.length > 0;
}

/* ===========================
   –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
=========================== */
document.getElementById("login-btn").onclick = login;
document.getElementById("reg-btn").onclick = register;

async function register() {
  let nick = normalizeNick(document.getElementById("reg-nick").value);
  let pass = document.getElementById("reg-pass").value;
  let dept = document.getElementById("reg-dept").value;

  if (!nick || pass.length < 4) {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–∏–∫ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å");
    return;
  }

  if (await userExists(nick)) {
    alert("–≠—Ç–æ—Ç –Ω–∏–∫ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
    return;
  }

  let { error } = await db.from("users").insert({
    nick, password: pass, department: dept, role: "user",
    notes1: "", notes2: "", notes3: "", notes_color: "#ffffff"
  });

  if (error) return alert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏");

  alert("–°–æ–∑–¥–∞–Ω–æ!");
  switchToLogin();
}

async function login() {
  let nick = normalizeNick(document.getElementById("login-nick").value);
  let pass = document.getElementById("login-pass").value;

  let { data } = await db
    .from("users")
    .select("*")
    .eq("nick", nick)
    .single();

  if (!data || data.password !== pass) {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å");
    return;
  }

  CURRENT_USER = data;
  localStorage.setItem("pd_user", JSON.stringify(CURRENT_USER));
  openPanel();
}

/* ===========================
   –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í
=========================== */
function switchToLogin() {
  document.getElementById("auth-register").classList.remove("active");
  document.getElementById("auth-login").classList.add("active");
}

function openPanel() {
  document.getElementById("auth-root").style.display = "none";
  document.getElementById("panel-root").style.display = "block";

  document.getElementById("user-nick").textContent = CURRENT_USER.nick;
  document.getElementById("user-role").textContent = CURRENT_USER.role;

  openTab("home");
}

function openTab(tab) {
  document.querySelectorAll(".panel-section").forEach(s => s.style.display = "none");

  if (tab === "home") document.getElementById("section-home").style.display = "block";
  if (tab === "personal") loadPersonalFiles();
  if (tab === "leadership") loadLeadership();
}

<!-- ===== –í–°–¢–ê–í–ò–¢–¨ JS –ß–ê–°–¢–¨ 2 –°–Æ–î–ê ===== -->
<script id="js-part2"></script>
    /* =======================================
   –õ–ò–ß–ù–´–ï –î–ï–õ–ê ‚Äî –°–ü–ò–°–û–ö –ò –ü–†–û–°–ú–û–¢–†
======================================= */

async function loadPersonalFiles() {
  document.getElementById("section-personal").innerHTML = "<h2>–õ–∏—á–Ω—ã–µ –¥–µ–ª–∞</h2>";

  let { data } = await db.from("personal_files").select("*");

  let wrap = document.getElementById("section-personal");

  // –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –µ—Å—Ç—å –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ ‚Äî –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è
  let mine = data.find(f => f.nick === CURRENT_USER.nick);

  if (mine) {
    let div = document.createElement("div");
    div.className = "pf-view";
    div.innerHTML = `
      <h3>–í–∞—à–µ –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ</h3>
      <p><b>–ù–∏–∫:</b> ${mine.nick}</p>
      <p><b>–ó–≤–∞–Ω–∏–µ:</b> ${mine.rank || "-"}</p>
      <button onclick="deleteMyPersonalFile()" class="btn" style="background:#dc2626">–£–¥–∞–ª–∏—Ç—å –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ</button>
      <hr>
    `;
    wrap.appendChild(div);
  }

  wrap.innerHTML += `<h3>–°–ø–∏—Å–æ–∫ –ª–∏—á–Ω—ã—Ö –¥–µ–ª</h3>`;

  data.forEach(pf => {
    let item = document.createElement("div");
    item.className = "pf-item";
    item.innerHTML = `[${pf.dept}] ${pf.nick} [${pf.account}]`;
    item.onclick = () => openPersonalFile(pf);
    wrap.appendChild(item);
  });

  document.getElementById("section-personal").style.display = "block";
}

async function deleteMyPersonalFile() {
  if (!confirm("–£–¥–∞–ª–∏—Ç—å –≤–∞—à–µ –ª–∏—á–Ω–æ–µ –¥–µ–ª–æ?")) return;

  await db.from("personal_files").delete().eq("nick", CURRENT_USER.nick);
  alert("–£–¥–∞–ª–µ–Ω–æ!");
  loadPersonalFiles();
}

/* –û—Ç–∫—Ä—ã—Ç–∏–µ –ª–∏—á–Ω–æ–≥–æ –¥–µ–ª–∞ */

function openPersonalFile(pf) {
  let wrap = document.getElementById("section-personal");
  wrap.innerHTML = `
    <button class="btn" onclick="openTab('personal')">‚¨Ö –ù–∞–∑–∞–¥</button>
    <div class="pf-view">
      <h2>${pf.nick}</h2>
      <p><b>–û—Ç–¥–µ–ª:</b> ${pf.dept}</p>
      <p><b>–ê–∫–∫–∞—É–Ω—Ç:</b> ${pf.account}</p>
      <p><b>–ó–≤–∞–Ω–∏–µ:</b> ${pf.rank}</p>
      <p><b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b> ${pf.contact}</p>
      <p><b>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</b> ${pf.birth}</p>
      <hr>
  `;

  // –ê–¥–º–∏–Ω/–º–æ–¥–µ—Ä –º–æ–∂–µ—Ç –ø—Ä–∞–≤–∏—Ç—å
  if (["admin", "moderator"].includes(CURRENT_USER.role)) {
    wrap.innerHTML += `
      <button class="btn" onclick="editPersonalFile('${pf.nick}')">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    `;
  }

  wrap.innerHTML += "</div>";
}

function editPersonalFile(nick) {
  // –ü–æ–∑–∂–µ —Å—é–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  alert("–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ (–≤–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—é–¥–∞)");
}


<!-- ===== –í–°–¢–ê–í–ò–¢–¨ JS –ß–ê–°–¢–¨ 3 –°–Æ–î–ê ===== -->
<script id="js-part3"></script>
    /* =======================================
   –†–£–ö–û–í–û–î–°–¢–í–û –ü–û–õ–ò–¶–ò–ò
======================================= */

let EDITING_LEADER = null;

async function loadLeadership() {
  let sec = document.getElementById("section-leadership");
  sec.innerHTML = "<h2>–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª–∏—Ü–∏–∏</h2>";

  let { data } = await db.from("users").select("*");

  let leaders = data.filter(u => ["admin", "moderator"].includes(u.role));

  leaders.forEach(l => {
    let card = document.createElement("div");
    card.className = "leader-card";

    card.innerHTML = `
      <div class="leader-name">${l.nick} (${l.role})</div>
      <div class="leader-notes" style="color:${l.notes_color}">
        ${l.notes1 || ""}<br>
        ${l.notes2 || ""}<br>
        ${l.notes3 || ""}
      </div>
    `;

    // –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥—Ä—É–≥–∏—Ö, –Ω–æ –Ω–µ —Å–∞–º–æ–≥–æ —Å–µ–±—è
    if (CURRENT_USER.role === "admin" && CURRENT_USER.nick !== l.nick) {
      let btn = document.createElement("button");
      btn.textContent = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å";
      btn.className = "btn";
      btn.style.marginTop = "10px";
      btn.onclick = () => openLeaderEdit(l);
      card.appendChild(btn);
    }

    sec.appendChild(card);
  });

  sec.style.display = "block";
}

/* ===== –ú–û–î–ê–õ–ö–ê ===== */

function openLeaderEdit(l) {
  EDITING_LEADER = l;

  document.getElementById("led-note1").value = l.notes1 || "";
  document.getElementById("led-note2").value = l.notes2 || "";
  document.getElementById("led-note3").value = l.notes3 || "";
  document.getElementById("led-color").value = l.notes_color || "#ffffff";

  document.getElementById("leader-edit-modal").classList.add("active");
}

function closeLeaderEdit() {
  EDITING_LEADER = null;
  document.getElementById("leader-edit-modal").classList.remove("active");
}

async function saveLeaderNotes() {
  if (!EDITING_LEADER) return;

  let n1 = document.getElementById("led-note1").value;
  let n2 = document.getElementById("led-note2").value;
  let n3 = document.getElementById("led-note3").value;
  let col = document.getElementById("led-color").value;

  await db.from("users")
    .update({
      notes1: n1,
      notes2: n2,
      notes3: n3,
      notes_color: col
    })
    .eq("nick", EDITING_LEADER.nick);

  closeLeaderEdit();
  loadLeadership();
}


</body>
</html>
