<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Police Platinum ‚Äî –†–µ–π—Ç–∏–Ω–≥ –ª–∏–¥–µ—Ä–æ–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --bg-card: #020617;
      --border: #1e293b;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent-pink: #ec4899;
      --accent-green: #22c55e;
      --accent-blue: #6366f1;
      --danger: #f97373;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px;
    }

    #bg-rotator {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      background: radial-gradient(circle at top, #111827 0, #020617 55%);
    }
    #bg-rotator img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      pointer-events: none;
    }
    #bg-rotator img.active {
      opacity: 1;
    }

    #app {
      width: 100%;
      max-width: 1200px;
    }

    a {
      color: var(--accent-pink);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* ---------- –û–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã ---------- */

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 4px 10px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #cbd5f5;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, #1f2937, #020617);
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(15, 23, 42, 0.8);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
      text-decoration: none;
      white-space: nowrap;
    }
    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.95);
    }
    .btn-sm {
      padding: 4px 10px;
      font-size: 12px;
    }
    .btn-primary {
      background: radial-gradient(circle at top, #ec4899 0, #6366f1 70%);
      border-color: rgba(248, 250, 252, 0.2);
    }
    .btn-outline {
      background: rgba(15, 23, 42, 0.9);
    }

    .card {
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.12) 0, rgba(15, 23, 42, 0.96) 50%, #020617 100%);
      border-radius: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
    }

    /* ---------- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ---------- */

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 18px;
      border-radius: 18px;
      margin-bottom: 14px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(8, 47, 73, 0.98));
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 16px 40px rgba(15, 23, 42, 0.9);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 0, #f97316 0, #e11d48 35%, #0ea5e9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 17px;
      color: #0f172a;
      box-shadow: 0 0 18px rgba(236, 72, 153, 0.9);
    }

    .topbar-title {
      font-size: 16px;
      font-weight: 600;
    }
    .topbar-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .top-user {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--muted);
    }
    .top-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      overflow: hidden;
      flex-shrink: 0;
    }
    .top-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .top-name {
      font-size: 13px;
      color: var(--text);
    }
    .top-role {
      font-size: 11px;
      color: var(--muted);
    }

    /* ---------- –•–∏—Ä–æ ---------- */

    .hero {
      margin-bottom: 16px;
      padding: 12px 18px;
      border-radius: 20px;
      background: radial-gradient(circle at top left, rgba(249, 115, 22, 0.16), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(248, 250, 252, 0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
    }

    .hero-main {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-title {
      font-size: 20px;
      font-weight: 600;
    }

    .hero-sub {
      font-size: 13px;
      color: var(--muted);
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    /* ---------- –õ–∏–¥–µ—Ä—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ ---------- */

    .leaders-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
      margin-bottom: 22px;
    }

    @media (max-width: 900px) {
      .leaders-grid {
        grid-template-columns: 1fr;
      }
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
      .topbar-right {
        align-self: stretch;
        justify-content: space-between;
      }
      .hero {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .leader-card {
      position: relative;
      padding: 16px 16px 14px;
      border-radius: 24px;
      background:
        radial-gradient(circle at top left, rgba(236, 72, 153, 0.18), rgba(15, 23, 42, 0.98)),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.18), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 18px 40px rgba(15, 23, 42, 0.95);
      overflow: hidden;
    }

    .leader-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .leader-dept-badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .leader-dept-badge span {
      opacity: 0.85;
    }

    .leader-card-body {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .leader-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 2px solid rgba(251, 191, 36, 0.9);
      background: radial-gradient(circle at top, #0f172a 0, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
      font-size: 20px;
      font-weight: 600;
      color: #fbbf24;
      position: relative;
      transition: box-shadow 0.12s ease, transform 0.12s ease, border-color 0.12s ease;
    }
    .leader-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* –ø–æ–¥—Å–≤–µ—Ç–∫–∞, —á—Ç–æ –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É */
    .leader-avatar-editable {
      cursor: pointer;
    }
    .leader-avatar-editable::after {
      content: "–ò–∑–º.";
      position: absolute;
      bottom: -2px;
      right: -2px;
      font-size: 9px;
      padding: 2px 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(248, 250, 252, 0.4);
      color: #e5e7eb;
    }
    .leader-avatar.drag-over {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.5);
      transform: translateY(-1px) scale(1.02);
    }

    .leader-main {
      flex: 1;
      min-width: 0;
    }

    .leader-nick {
      font-size: 16px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .leader-account {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    .leader-empty {
      font-size: 13px;
      color: var(--muted);
      margin-top: 2px;
    }

    .leader-score {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    .leader-points {
      font-size: 26px;
      font-weight: 700;
      background: linear-gradient(135deg, #f97316, #ec4899, #6366f1);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 18px rgba(236, 72, 153, 0.5);
    }

    .leader-points-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #c4b5fd;
    }

    .leader-footer {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
    }

    .leader-updated {
      opacity: 0.8;
    }

    .leader-actions {
      display: flex;
      gap: 6px;
    }

    /* ---------- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ---------- */

    .stats-section {
      margin-top: 6px;
      padding: 14px 16px 16px;
      border-radius: 22px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top, rgba(236, 72, 153, 0.18), rgba(15, 23, 42, 0.98));
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 20px 48px rgba(15, 23, 42, 0.95);
    }

    .stats-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .stats-title {
      font-size: 15px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stats-tabs {
      display: inline-flex;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 4px;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .stats-tab {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
      background: transparent;
      color: #cbd5f5;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.12s ease, box-shadow 0.12s ease, transform 0.12s ease;
    }

    .stats-tab span.icon {
      font-size: 14px;
    }

    .stats-tab.active {
      background: linear-gradient(135deg, #ec4899, #6366f1);
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.6), 0 0 30px rgba(236, 72, 153, 0.8);
      transform: translateY(-1px);
    }

    .stats-date {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
      text-align: center;
    }

    .stats-list {
      margin-top: 6px;
    }

    .stats-row {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr) auto;
      align-items: center;
      gap: 14px;
      padding: 10px 12px;
      margin-bottom: 8px;
      border-radius: 18px;
      background: radial-gradient(circle at left, rgba(148, 163, 184, 0.14), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.6);
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.9);
    }

    .stats-row-medal {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .stats-row-medal.gold {
      color: #fde047;
      text-shadow: 0 0 16px rgba(250, 204, 21, 0.9);
    }
    .stats-row-medal.silver {
      color: #e5e7eb;
      text-shadow: 0 0 16px rgba(148, 163, 184, 0.9);
    }
    .stats-row-medal.bronze {
      color: #fb923c;
      text-shadow: 0 0 16px rgba(248, 150, 70, 0.9);
    }

    .stats-row-user {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .stats-avatar {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      overflow: hidden;
      border: 2px solid rgba(236, 72, 153, 0.8);
      box-shadow: 0 0 18px rgba(236, 72, 153, 0.6);
      flex-shrink: 0;
    }
    .stats-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .stats-name-block {
      min-width: 0;
    }

    .stats-nick {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .stats-account {
      font-size: 12px;
      color: var(--muted);
    }

    .stats-score-block {
      text-align: right;
    }

    .stats-points {
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(135deg, #f97316, #ec4899, #6366f1);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .stats-points-suffix {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #c4b5fd;
    }

    .stats-empty {
      font-size: 13px;
      color: var(--muted);
      padding: 16px 4px 6px;
      text-align: center;
    }

    .error-banner {
      font-size: 13px;
      color: #fecaca;
      background: rgba(220, 38, 38, 0.15);
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(248, 113, 113, 0.4);
      margin-top: 6px;
      text-align: center;
    }

    /* ---------- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏–¥–µ—Ä–∞ ---------- */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      width: 100%;
      max-width: 420px;
      background: #020617;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 14px 16px 16px;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 24px 56px rgba(15, 23, 42, 1);
    }
    .modal h3 {
      font-size: 17px;
      margin-bottom: 4px;
    }
    .modal p {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .field {
      margin-bottom: 8px;
    }
    .field label {
      display: block;
      font-size: 12px;
      margin-bottom: 3px;
    }
    .field input,
    .field select {
      width: 100%;
      border-radius: 9px;
      border: 1px solid var(--border);
      padding: 7px 9px;
      background: #020617;
      color: var(--text);
      font-size: 13px;
    }
    .field input[type="file"] {
      padding: 4px;
      font-size: 12px;
      background: #020617;
    }
    .field small {
      font-size: 11px;
      color: var(--muted);
    }
    .modal-footer {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }
  </style>
</head>
<body>
<div id="bg-rotator"></div>
<div id="app">

  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">PP</div>
      <div>
        <div class="topbar-title">–†–µ–π—Ç–∏–Ω–≥ –ª–∏–¥–µ—Ä–æ–≤</div>
        <div class="topbar-sub">–õ–∏–¥–µ—Ä—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
      </div>
    </div>

    <div class="topbar-right">
      <div class="top-user" id="top-user">
        <div class="top-avatar" id="top-avatar">P</div>
        <div>
          <div class="top-name" id="top-nick">–ì–æ—Å—Ç—å</div>
          <div class="top-role" id="top-role">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏</div>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é -->
      <a href="index.html" class="btn btn-outline btn-sm">‚üµ –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–∞–Ω–µ–ª—å PD</a>
    </div>
  </header>

  <!-- –•–∏—Ä–æ -->
  <section class="hero">
    <div class="hero-main">
      <div class="hero-title">–õ–∏–¥–µ—Ä—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ PD</div>
      <div class="hero-sub">
        –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä—ã LSPD, SFPD –∏ LVPD.
        –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –ª–∏–¥–µ—Ä–æ–≤.
      </div>
      <div class="hero-badges">
        <div class="chip">
          ‚≠ê <span>–†–µ–π—Ç–∏–Ω–≥ –ª–∏–¥–µ—Ä–æ–≤</span>
        </div>
        <div class="chip">
          üìä <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
        </div>
      </div>
    </div>
  </section>

  <!-- –õ–∏–¥–µ—Ä—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ -->
  <section class="leaders-grid">
    <!-- LSPD -->
    <article class="leader-card" data-dept="LSPD">
      <div class="leader-card-header">
        <div class="leader-dept-badge">
          <span>üöî LSPD</span>
          <span>Los Santos PD</span>
        </div>
      </div>

      <div class="leader-card-body">
        <div class="leader-avatar" data-dept-avatar="LSPD">
          LS
        </div>

        <div class="leader-main">
          <div class="leader-nick" data-leader-nick="LSPD">–õ–∏–¥–µ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</div>
          <div class="leader-account" data-leader-account="LSPD"></div>
          <div class="leader-empty" data-leader-empty="LSPD">–£–∫–∞–∂–∏—Ç–µ –ª–∏–¥–µ—Ä–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ LSPD.</div>
        </div>

        <div class="leader-score">
          <div class="leader-points" data-leader-points="LSPD">0</div>
          <div class="leader-points-label">–ê–® ‚Äî –æ—á–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
        </div>
      </div>

      <div class="leader-footer">
        <div class="leader-updated" data-leader-updated="LSPD">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî</div>
        <div class="leader-actions">
          <button class="btn btn-sm btn-outline" data-leader-edit="LSPD" style="display:none;">
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>
      </div>
    </article>

    <!-- SFPD -->
    <article class="leader-card" data-dept="SFPD">
      <div class="leader-card-header">
        <div class="leader-dept-badge">
          <span>üöî SFPD</span>
          <span>San Fierro PD</span>
        </div>
      </div>

      <div class="leader-card-body">
        <div class="leader-avatar" data-dept-avatar="SFPD">
          SF
        </div>

        <div class="leader-main">
          <div class="leader-nick" data-leader-nick="SFPD">–õ–∏–¥–µ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</div>
          <div class="leader-account" data-leader-account="SFPD"></div>
          <div class="leader-empty" data-leader-empty="SFPD">–£–∫–∞–∂–∏—Ç–µ –ª–∏–¥–µ—Ä–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ SFPD.</div>
        </div>

        <div class="leader-score">
          <div class="leader-points" data-leader-points="SFPD">0</div>
          <div class="leader-points-label">–ê–® ‚Äî –æ—á–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
        </div>
      </div>

      <div class="leader-footer">
        <div class="leader-updated" data-leader-updated="SFPD">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî</div>
        <div class="leader-actions">
          <button class="btn btn-sm btn-outline" data-leader-edit="SFPD" style="display:none;">
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>
      </div>
    </article>

    <!-- LVPD -->
    <article class="leader-card" data-dept="LVPD">
      <div class="leader-card-header">
        <div class="leader-dept-badge">
          <span>üöî LVPD</span>
          <span>Las Venturas PD</span>
        </div>
      </div>

      <div class="leader-card-body">
        <div class="leader-avatar" data-dept-avatar="LVPD">
          LV
        </div>

        <div class="leader-main">
          <div class="leader-nick" data-leader-nick="LVPD">–õ–∏–¥–µ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</div>
          <div class="leader-account" data-leader-account="LVPD"></div>
          <div class="leader-empty" data-leader-empty="LVPD">–£–∫–∞–∂–∏—Ç–µ –ª–∏–¥–µ—Ä–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ LVPD.</div>
        </div>

        <div class="leader-score">
          <div class="leader-points" data-leader-points="LVPD">0</div>
          <div class="leader-points-label">–ê–® ‚Äî –æ—á–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
        </div>
      </div>

      <div class="leader-footer">
        <div class="leader-updated" data-leader-updated="LVPD">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî</div>
        <div class="leader-actions">
          <button class="btn btn-sm btn-outline" data-leader-edit="LVPD" style="display:none;">
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>
      </div>
    </article>
  </section>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è / –Ω–µ–¥–µ–ª–∏ -->
  <section class="stats-section">
    <div class="stats-header">
      <div class="stats-title">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–∏–¥–µ—Ä–æ–≤
      </div>
      <div class="stats-tabs">
        <button class="stats-tab active" data-period="day">
          <span class="icon">üíú</span>
          <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è</span>
        </button>
        <button class="stats-tab" data-period="week">
          <span class="icon">üíö</span>
          <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–µ–ª–∏</span>
        </button>
      </div>
    </div>
    <div id="stats-date" class="stats-date">‚Äî</div>
    <div id="stats-list" class="stats-list">
      –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
    </div>
  </section>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏–¥–µ—Ä–∞ -->
<div id="leader-edit-modal" class="modal-backdrop">
  <div class="modal">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–¥–µ—Ä–∞</h3>
    <p>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–æ–≤.</p>

    <form id="leader-edit-form">
      <div class="field">
        <label for="leader-edit-dept">–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</label>
        <select id="leader-edit-dept">
          <option value="LSPD">LSPD ‚Äî Los Santos PD</option>
          <option value="SFPD">SFPD ‚Äî San Fierro PD</option>
          <option value="LVPD">LVPD ‚Äî Las Venturas PD</option>
        </select>
      </div>

      <div class="field">
        <label for="leader-edit-nick">–ù–∏–∫–Ω–µ–π–º –ª–∏–¥–µ—Ä–∞</label>
        <input id="leader-edit-nick" type="text" placeholder="–ò–º—è_–§–∞–º–∏–ª–∏—è" />
      </div>

      <div class="field">
        <label for="leader-edit-account">–ù–æ–º–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞ (–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ [–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö])</label>
        <input id="leader-edit-account" type="text" placeholder="123456" />
      </div>

      <div class="field">
        <label for="leader-edit-points">–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ (–ê–®)</label>
        <input id="leader-edit-points" type="number" min="0" step="1" />
      </div>

      <div class="field">
        <label for="leader-edit-avatar">–ê–≤–∞—Ç–∞—Ä–∫–∞ –ª–∏–¥–µ—Ä–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
        <input id="leader-edit-avatar" type="file" accept="image/*" />
        <small>–ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–¥–µ—Å—å –∏–ª–∏ –∫–ª–∏–∫–Ω—É—Ç—å/–ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –ø—Ä—è–º–æ –ø–æ –∞–≤–∞—Ç–∞—Ä–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ.</small>
      </div>
    </form>

    <div class="modal-footer">
      <button class="btn btn-sm btn-outline" id="leader-edit-cancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-sm btn-primary" id="leader-edit-save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç –¥–ª—è —Å–º–µ–Ω—ã –∞–≤–∞—Ç–∞—Ä–∫–∏ —Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<input type="file" id="leader-avatar-hidden" accept="image/*" style="display:none;" />

<!-- Supabase JS -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
  /* =============== –ù–ê–°–¢–†–û–ô–ö–ê SUPABASE =============== */

  const SUPABASE_URL = "https://qjbhflpoelgusfhymipi.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqYmhmbHBvZWxndXNmaHltaXBpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NzEzODMsImV4cCI6MjA4MDQ0NzM4M30.OUBE062cKr4p4KpKlZlWIYCmqCBpXK43tQq9m-laDfg";

  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /* =============== –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï =============== */

  let currentUser = null;
  const leadersState = {}; // –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º: { LSPD: {...}, SFPD: {...}, LVPD: {...} }
  let avatarChangeDept = null; // –¥–ª—è —Å–∫—Ä—ã—Ç–æ–≥–æ –∏–Ω–ø—É—Ç–∞
  let modalAvatarData = null;  // –∞–≤–∞—Ç–∞—Ä–∫–∞ –∏–∑ –º–æ–¥–∞–ª–∫–∏

  /* =============== –£–¢–ò–õ–ò–¢–´ =============== */

  function loadSession() {
    try {
      return JSON.parse(localStorage.getItem("pp_user"));
    } catch {
      return null;
    }
  }

  function roleLabel(role) {
    if (role === "admin") return "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä";
    if (role === "moderator") return "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä";
    if (role === "creator") return "–†–µ–¥–∞–∫—Ç–æ—Ä";
    return "–û—Ñ–∏—Ü–µ—Ä";
  }

  function isAdminLike(user) {
    if (!user) return false;
    return (
      user.role === "admin" ||
      user.role === "moderator" ||
      user.role === "creator"
    );
  }

  function formatDateTime(str) {
    if (!str) return "‚Äî";
    const d = new Date(str);
    if (Number.isNaN(d.getTime())) return "‚Äî";
    return d.toLocaleString("ru-RU");
  }

  function showErrorBanner(container, message) {
    if (!container) return;
    const div = document.createElement("div");
    div.className = "error-banner";
    div.textContent = message || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.";
    container.appendChild(div);
  }

  /* =============== –¢–ï–ú–ê (–±–µ—Ä—ë–º –∏–∑ theme_settings) =============== */

  let themeConfig = {
    images: [],
    opacity: 80,
    blur: 0,
    borderColor: "#1e293b",
    favicon: null,
    siteTitle: null
  };
  let bgRotationTimer = null;
  let bgCurrentIndex = 0;

  async function loadThemeFromDB() {
    const { data, error } = await supabaseClient
      .from("theme_settings")
      .select("*")
      .eq("id", 1)
      .maybeSingle();

    if (error || !data) return;

    themeConfig = {
      images: data.images || [],
      opacity: data.opacity ?? 80,
      blur: data.blur ?? 0,
      borderColor: data.border_color || "#1e293b",
      favicon: data.favicon || null,
      siteTitle: data.site_title || null
    };
  }

  function applyThemeBackground() {
    const bg = document.getElementById("bg-rotator");
    if (!bg) return;

    bg.innerHTML = "";
    const imgs = themeConfig.images || [];
    const blurPx = themeConfig.blur || 0;

    if (!imgs.length) {
      bg.style.background = "radial-gradient(circle at top, #111827 0, #020617 55%)";
      return;
    }

    imgs.forEach((src, index) => {
      const img = document.createElement("img");
      img.src = src;
      img.style.filter = `blur(${blurPx}px)`;
      if (index === 0) img.classList.add("active");
      bg.appendChild(img);
    });

    if (bgRotationTimer) {
      clearInterval(bgRotationTimer);
      bgRotationTimer = null;
    }

    if (imgs.length > 1) {
      const imgEls = Array.from(bg.querySelectorAll("img"));
      bgCurrentIndex = 0;
      bgRotationTimer = setInterval(() => {
        const prev = imgEls[bgCurrentIndex];
        bgCurrentIndex = (bgCurrentIndex + 1) % imgEls.length;
        const next = imgEls[bgCurrentIndex];
        if (prev) prev.classList.remove("active");
        if (next) next.classList.add("active");
      }, 60 * 1000);
    }
  }

  function applyThemeToBlocks() {
    const opacity = (themeConfig.opacity || 80) / 100;
    const borderColor = themeConfig.borderColor || "#1e293b";

    document.documentElement.style.setProperty("--border", borderColor);

    const blocks = document.querySelectorAll(
      ".topbar, .hero, .leader-card, .stats-section"
    );
    blocks.forEach((el) => {
      el.style.backgroundColor = `rgba(15,23,42,${opacity})`;
      el.style.backdropFilter = themeConfig.blur
        ? `blur(${themeConfig.blur}px)`
        : "blur(12px)";
    });
  }

  function applySiteBranding() {
    if (themeConfig.siteTitle) {
      document.title = themeConfig.siteTitle;
    } else {
      document.title = "Police Platinum ‚Äî –†–µ–π—Ç–∏–Ω–≥ –ª–∏–¥–µ—Ä–æ–≤";
    }

    if (themeConfig.favicon) {
      let link = document.querySelector("link[rel~='icon']");
      if (!link) {
        link = document.createElement("link");
        link.rel = "icon";
        document.head.appendChild(link);
      }
      link.href = themeConfig.favicon;
    }
  }

  /* =============== –¢–û–ü-–ë–ê–† =============== */

  function refreshTopBar() {
    const topNick = document.getElementById("top-nick");
    const topRole = document.getElementById("top-role");
    const topAvatar = document.getElementById("top-avatar");

    if (!topNick || !topRole || !topAvatar) return;

    if (!currentUser) {
      topNick.textContent = "–ì–æ—Å—Ç—å";
      topRole.textContent = "–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏";
      topAvatar.textContent = "P";
      topAvatar.style.borderColor = "#1e293b";
      topAvatar.innerHTML = "P";
      return;
    }

    topNick.textContent = currentUser.nick || "–û—Ñ–∏—Ü–µ—Ä";
    topRole.textContent = roleLabel(currentUser.role || "user");

    topAvatar.innerHTML = "";
    topAvatar.style.borderColor = currentUser.border_color || "#1e293b";
    if (currentUser.avatar_url) {
      const img = document.createElement("img");
      img.src = currentUser.avatar_url;
      topAvatar.appendChild(img);
    } else {
      topAvatar.textContent = currentUser.nick ? currentUser.nick[0] : "P";
    }
  }

  /* =============== –õ–ò–î–ï–†–´ –î–ï–ü–ê–†–¢–ê–ú–ï–ù–¢–û–í =============== */

  const DEPT_LABELS = {
    LSPD: { short: "LS", name: "LSPD ‚Äî Los Santos PD" },
    SFPD: { short: "SF", name: "SFPD ‚Äî San Fierro PD" },
    LVPD: { short: "LV", name: "LVPD ‚Äî Las Venturas PD" }
  };

  async function loadLeaders() {
    const { data, error } = await supabaseClient
      .from("pd_leaders")
      .select("*");

    if (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–æ–≤:", error);
    }

    (["LSPD", "SFPD", "LVPD"]).forEach((dept) => {
      leadersState[dept] = null;
    });

    (data || []).forEach((row) => {
      if (row.department && leadersState.hasOwnProperty(row.department)) {
        leadersState[row.department] = row;
      }
    });

    renderAllLeaderCards();
    initAvatarEditing();  // —á—Ç–æ–±—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ —Å–Ω–æ–≤–∞ –±—ã–ª–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã
  }

  function renderAllLeaderCards() {
    ["LSPD", "SFPD", "LVPD"].forEach((dept) => {
      renderLeaderCard(dept, leadersState[dept]);
    });
  }

  function renderLeaderCard(dept, row) {
    const avatarEl = document.querySelector(`[data-dept-avatar="${dept}"]`);
    const nickEl = document.querySelector(`[data-leader-nick="${dept}"]`);
    const accEl = document.querySelector(`[data-leader-account="${dept}"]`);
    const emptyEl = document.querySelector(`[data-leader-empty="${dept}"]`);
    const pointsEl = document.querySelector(`[data-leader-points="${dept}"]`);
    const updatedEl = document.querySelector(`[data-leader-updated="${dept}"]`);
    const editBtn = document.querySelector(`[data-leader-edit="${dept}"]`);

    const deptInfo = DEPT_LABELS[dept];

    if (avatarEl) {
      avatarEl.innerHTML = "";
      if (row && row.avatar_url) {
        const img = document.createElement("img");
        img.src = row.avatar_url;
        avatarEl.appendChild(img);
      } else {
        avatarEl.textContent = deptInfo ? deptInfo.short : "?";
      }
    }

    if (row) {
      if (nickEl) nickEl.textContent = row.nick || "–ë–µ–∑ –∏–º–µ–Ω–∏";
      if (accEl) {
        accEl.textContent = row.account_id ? `[${row.account_id}]` : "";
      }
      if (emptyEl) {
        emptyEl.textContent = row.nick
          ? "–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ª–∏–¥–µ—Ä –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞."
          : "–£–∫–∞–∂–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–∞.";
      }
      if (pointsEl) {
        pointsEl.textContent =
          typeof row.points === "number" && !Number.isNaN(row.points)
            ? row.points
            : 0;
      }
      if (updatedEl) {
        updatedEl.textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–æ: " + formatDateTime(row.updated_at);
      }
    } else {
      if (nickEl) nickEl.textContent = "–õ–∏–¥–µ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω";
      if (accEl) accEl.textContent = "";
      if (emptyEl) {
        emptyEl.textContent = `–£–∫–∞–∂–∏—Ç–µ –ª–∏–¥–µ—Ä–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ ${dept}.`;
      }
      if (pointsEl) pointsEl.textContent = "0";
      if (updatedEl) updatedEl.textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî";
    }

    if (editBtn) {
      editBtn.style.display = isAdminLike(currentUser) ? "inline-flex" : "none";
      editBtn.onclick = () => openLeaderEditModal(dept);
    }
  }

  /* –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ –∫–ª–∏–∫–æ–º / dnd –ø—Ä—è–º–æ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ */

  function initAvatarEditing() {
    const canEdit = isAdminLike(currentUser);
    const avatarInputHidden = document.getElementById("leader-avatar-hidden");
    if (!avatarInputHidden) return;

    document
      .querySelectorAll(".leader-avatar")
      .forEach((avatarEl) => {
        const dept = avatarEl.getAttribute("data-dept-avatar");
        avatarEl.classList.remove("leader-avatar-editable", "drag-over");
        avatarEl.onclick = null;
        avatarEl.ondragover = null;
        avatarEl.ondragleave = null;
        avatarEl.ondrop = null;

        if (!canEdit || !dept) return;

        avatarEl.classList.add("leader-avatar-editable");

        avatarEl.onclick = () => {
          avatarChangeDept = dept;
          avatarInputHidden.value = "";
          avatarInputHidden.click();
        };

        avatarEl.ondragover = (e) => {
          e.preventDefault();
          avatarEl.classList.add("drag-over");
        };

        avatarEl.ondragleave = () => {
          avatarEl.classList.remove("drag-over");
        };

        avatarEl.ondrop = (e) => {
          e.preventDefault();
          avatarEl.classList.remove("drag-over");
          const file = e.dataTransfer.files && e.dataTransfer.files[0];
          if (file) {
            saveLeaderAvatarFromFile(dept, file);
          }
        };
      });

    avatarInputHidden.onchange = () => {
      const file = avatarInputHidden.files && avatarInputHidden.files[0];
      if (file && avatarChangeDept) {
        saveLeaderAvatarFromFile(avatarChangeDept, file);
      }
    };
  }

  async function saveLeaderAvatarFromFile(dept, file) {
    try {
      const reader = new FileReader();
      reader.onload = async () => {
        const dataUrl = reader.result;
        const { data: existing, error: selError } = await supabaseClient
          .from("pd_leaders")
          .select("id")
          .eq("department", dept)
          .maybeSingle();

        if (selError) {
          console.error(selError);
        }

        const payload = {
          department: dept,
          avatar_url: dataUrl
        };

        let upError = null;
        if (existing && existing.id) {
          const { error } = await supabaseClient
            .from("pd_leaders")
            .update(payload)
            .eq("id", existing.id);
          upError = error;
        } else {
          const { error } = await supabaseClient
            .from("pd_leaders")
            .insert(payload);
          upError = error;
        }

        if (upError) {
          console.error(upError);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É –ª–∏–¥–µ—Ä–∞.");
          return;
        }

        await loadLeaders();
      };
      reader.onerror = () => {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∫–∏.");
      };
      reader.readAsDataURL(file);
    } catch (e) {
      console.error(e);
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞–≤–∞—Ç–∞—Ä–∫–∏.");
    }
  }

  /* =============== –ú–û–î–ê–õ–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –õ–ò–î–ï–†–ê =============== */

  const leaderEditModal = document.getElementById("leader-edit-modal");
  const leaderEditForm = document.getElementById("leader-edit-form");
  const leaderEditDept = document.getElementById("leader-edit-dept");
  const leaderEditNick = document.getElementById("leader-edit-nick");
  const leaderEditAccount = document.getElementById("leader-edit-account");
  const leaderEditPoints = document.getElementById("leader-edit-points");
  const leaderEditAvatar = document.getElementById("leader-edit-avatar");
  const leaderEditCancel = document.getElementById("leader-edit-cancel");
  const leaderEditSave = document.getElementById("leader-edit-save");

  let modalDept = "LSPD";

  function openLeaderEditModal(dept) {
    if (!isAdminLike(currentUser)) {
      alert("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–∏–¥–µ—Ä–æ–≤.");
      return;
    }

    modalDept = dept || "LSPD";
    const row = leadersState[modalDept] || {};

    modalAvatarData = null;
    leaderEditAvatar.value = "";

    leaderEditDept.value = modalDept;
    leaderEditNick.value = row.nick || "";
    leaderEditAccount.value = row.account_id || "";
    leaderEditPoints.value =
      typeof row.points === "number" && !Number.isNaN(row.points)
        ? row.points
        : "";

    leaderEditModal.classList.add("active");
  }

  function closeLeaderEditModal() {
    leaderEditModal.classList.remove("active");
    modalAvatarData = null;
    if (leaderEditAvatar) leaderEditAvatar.value = "";
  }

  if (leaderEditCancel) {
    leaderEditCancel.onclick = () => {
      closeLeaderEditModal();
    };
  }

  if (leaderEditAvatar) {
    leaderEditAvatar.onchange = () => {
      const file = leaderEditAvatar.files && leaderEditAvatar.files[0];
      if (!file) {
        modalAvatarData = null;
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        modalAvatarData = reader.result;
      };
      reader.onerror = () => {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∫–∏.");
      };
      reader.readAsDataURL(file);
    };
  }

  if (leaderEditSave) {
    leaderEditSave.onclick = async (e) => {
      e.preventDefault();
      if (!isAdminLike(currentUser)) {
        alert("–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–¥–µ—Ä–æ–≤.");
        return;
      }

      const dept = leaderEditDept.value || modalDept || "LSPD";
      const nick = (leaderEditNick.value || "").trim();
      const accountId = (leaderEditAccount.value || "").trim();
      let pointsVal = leaderEditPoints.value;
      pointsVal = pointsVal === "" ? null : Number(pointsVal);
      if (pointsVal !== null && (Number.isNaN(pointsVal) || pointsVal < 0)) {
        alert("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.");
        return;
      }

      const { data: existing, error: selError } = await supabaseClient
        .from("pd_leaders")
        .select("id")
        .eq("department", dept)
        .maybeSingle();

      if (selError) {
        console.error(selError);
      }

      const payload = {
        department: dept,
        nick: nick || null,
        account_id: accountId || null,
        points: pointsVal,
        updated_at: new Date().toISOString()
      };

      if (modalAvatarData) {
        payload.avatar_url = modalAvatarData;
      }

      let upError = null;
      if (existing && existing.id) {
        const { error } = await supabaseClient
          .from("pd_leaders")
          .update(payload)
          .eq("id", existing.id);
        upError = error;
      } else {
        const { error } = await supabaseClient
          .from("pd_leaders")
          .insert(payload);
        upError = error;
      }

      if (upError) {
        console.error(upError);
        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏–¥–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É pd_leaders.");
        return;
      }

      closeLeaderEditModal();
      await loadLeaders();
    };
  }

  /* =============== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –î–ù–Ø / –ù–ï–î–ï–õ–ò =============== */

  const statsListEl = document.getElementById("stats-list");
  const statsDateEl = document.getElementById("stats-date");
  const statsTabs = document.querySelectorAll(".stats-tab");
  let currentPeriod = "day";

  function updateStatsDateLabel() {
    if (!statsDateEl) return;
    const now = new Date();
    if (currentPeriod === "day") {
      statsDateEl.textContent = now.toLocaleDateString("ru-RU", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });
    } else {
      // –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è –ø–æ–¥–ø–∏—Å—å –Ω–µ–¥–µ–ª–∏: "–ù–µ–¥–µ–ª—è, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∞—è—Å—è ..."
      const weekEnd = now.toLocaleDateString("ru-RU", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });
      statsDateEl.textContent = `–ù–µ–¥–µ–ª—è, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∞—è—Å—è ${weekEnd}`;
    }
  }

  if (statsTabs) {
    statsTabs.forEach((btn) => {
      btn.onclick = () => {
        const period = btn.dataset.period || "day";
        currentPeriod = period;

        statsTabs.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        updateStatsDateLabel();
        loadStats();
      };
    });
  }

  async function loadStats() {
    if (!statsListEl) return;

    statsListEl.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...";

    // –û–∂–∏–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É leader_stats:
    // id, nick, account_id, avatar_url, points, period ('day'/'week'), created_at
    const { data, error } = await supabaseClient
      .from("leader_stats")
      .select("*")
      .eq("period", currentPeriod)
      .order("points", { ascending: false })
      .limit(50);

    if (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
      statsListEl.innerHTML = "";
      showErrorBanner(
        statsListEl,
        "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É leader_stats –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞."
      );
      return;
    }

    if (!data || !data.length) {
      statsListEl.innerHTML = "";
      const empty = document.createElement("div");
      empty.className = "stats-empty";
      empty.textContent = "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.";
      statsListEl.appendChild(empty);
      return;
    }

    statsListEl.innerHTML = "";

    data.forEach((row, index) => {
      const item = document.createElement("div");
      item.className = "stats-row";

      const medal = document.createElement("div");
      medal.className = "stats-row-medal";
      const place = index + 1;
      if (place === 1) medal.classList.add("gold");
      else if (place === 2) medal.classList.add("silver");
      else if (place === 3) medal.classList.add("bronze");
      medal.textContent = place === 1 ? "üèÜ" : place === 2 ? "ü•à" : place === 3 ? "ü•â" : place;

      const userBlock = document.createElement("div");
      userBlock.className = "stats-row-user";

      const avatar = document.createElement("div");
      avatar.className = "stats-avatar";
      if (row.avatar_url) {
        const img = document.createElement("img");
        img.src = row.avatar_url;
        avatar.appendChild(img);
      } else {
        const fallback = document.createElement("div");
        fallback.style.width = "100%";
        fallback.style.height = "100%";
        fallback.style.display = "flex";
        fallback.style.alignItems = "center";
        fallback.style.justifyContent = "center";
        fallback.style.fontWeight = "600";
        fallback.textContent = (row.nick || "U")[0];
        avatar.appendChild(fallback);
      }

      const nameBlock = document.createElement("div");
      nameBlock.className = "stats-name-block";

      const nick = document.createElement("div");
      nick.className = "stats-nick";
      nick.textContent = row.nick || "–ë–µ–∑ –∏–º–µ–Ω–∏";

      const acc = document.createElement("div");
      acc.className = "stats-account";
      acc.textContent = row.account_id ? `[${row.account_id}]` : "";

      nameBlock.appendChild(nick);
      nameBlock.appendChild(acc);

      userBlock.appendChild(avatar);
      userBlock.appendChild(nameBlock);

      const scoreBlock = document.createElement("div");
      scoreBlock.className = "stats-score-block";

      const pts = document.createElement("div");
      pts.className = "stats-points";
      pts.textContent =
        typeof row.points === "number" && !Number.isNaN(row.points)
          ? row.points
          : 0;

      const suffix = document.createElement("div");
      suffix.className = "stats-points-suffix";
      suffix.textContent = "–ê–®";

      scoreBlock.appendChild(pts);
      scoreBlock.appendChild(suffix);

      item.appendChild(medal);
      item.appendChild(userBlock);
      item.appendChild(scoreBlock);

      statsListEl.appendChild(item);
    });
  }

  /* =============== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =============== */

  window.addEventListener("load", async () => {
    // –¢–µ–º–∞
    await loadThemeFromDB();
    applyThemeBackground();
    applyThemeToBlocks();
    applySiteBranding();

    // –°–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const session = loadSession();
    if (session) {
      currentUser = session;
    }
    refreshTopBar();

    // –õ–∏–¥–µ—Ä—ã
    await loadLeaders();

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    updateStatsDateLabel();
    await loadStats();
  });
</script>
</body>
</html>
